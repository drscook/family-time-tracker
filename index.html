<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Time Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Lucide icons as components
        const Play = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );
        
        const Square = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            </svg>
        );
        
        const Settings = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m5.2-15.8 4.2 4.2m-14.8 0L2.4 7.6m15.8 8.8-4.2 4.2m0-14.8 4.2-4.2"></path>
            </svg>
        );
        
        const RefreshCw = ({ size = 28 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="animate-spin">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </svg>
        );
        
        const Trash2 = ({ size = 16 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );
        
        const Edit2 = ({ size = 16 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );
        
        const Check = ({ size = 20 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );
        
        const X = ({ size = 20 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        function TimeTracker() {
            const [entries, setEntries] = useState([]);
            const [isTracking, setIsTracking] = useState(false);
            const [currentTask, setCurrentTask] = useState('');
            const [startTime, setStartTime] = useState(null);
            const [elapsedSeconds, setElapsedSeconds] = useState(0);
            const [editingId, setEditingId] = useState(null);
            const [editTask, setEditTask] = useState('');
            const [editStartTime, setEditStartTime] = useState('');
            const [editEndTime, setEditEndTime] = useState('');
            const [userName, setUserName] = useState('');
            const [showNamePrompt, setShowNamePrompt] = useState(true);
            const [sheetUrl, setSheetUrl] = useState('');
            const [showSettings, setShowSettings] = useState(false);
            const [syncing, setSyncing] = useState(false);
            const [syncMessage, setSyncMessage] = useState('');
            
            // Dropdown options - customize these for your family!
            const [userOptions, setUserOptions] = useState(['Scott', 'Sarah', 'Alex', 'Emma']);
            const [taskOptions, setTaskOptions] = useState(['Homework', 'Reading', 'Chores', 'Practice', 'Project', 'Exercise', 'Other']);
            
            // Load custom options from localStorage
            useEffect(() => {
                const savedUsers = localStorage.getItem('userOptions');
                const savedTasks = localStorage.getItem('taskOptions');
                if (savedUsers) setUserOptions(JSON.parse(savedUsers));
                if (savedTasks) setTaskOptions(JSON.parse(savedTasks));
            }, []);

            useEffect(() => {
                // Google Apps Script URL - pre-configured for all family members
                const DEFAULT_SHEET_URL = 'https://script.google.com/macros/s/AKfycbzRmGCDC-dBGS_92naJ0rtLTExtvGZXKvj7R72hqQjLnx0qmV-yqpigU4CjjOXgCG7hxQ/exec';
                
                const savedUrl = localStorage.getItem('sheetUrl');
                const savedName = localStorage.getItem('userName');
                
                // Use default URL if none is saved
                if (!savedUrl) {
                    setSheetUrl(DEFAULT_SHEET_URL);
                } else {
                    setSheetUrl(savedUrl);
                }
                
                if (savedName) {
                    setUserName(savedName);
                    setShowNamePrompt(false);
                }
            }, []);

            useEffect(() => {
                let interval;
                if (isTracking) {
                    interval = setInterval(() => {
                        setElapsedSeconds(Math.floor((Date.now() - startTime) / 1000));
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [isTracking, startTime]);

            const formatTime = (seconds) => {
                const hrs = Math.floor(seconds / 3600);
                const mins = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;
                return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };

            const formatDateTime = (date) => {
                return new Date(date).toLocaleString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });
            };
            
            const formatDateTimeForInput = (timestamp) => {
                const date = new Date(timestamp);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                return `${year}-${month}-${day}T${hours}:${minutes}`;
            };

            const syncToSheet = async (entry) => {
                if (!sheetUrl) {
                    setSyncMessage('⚠️ Google Sheet URL not set');
                    setTimeout(() => setSyncMessage(''), 3000);
                    return false;
                }

                setSyncing(true);
                setSyncMessage('⏳ Sending to Google Sheets...');
                
                try {
                    const response = await fetch(sheetUrl, {
                        method: 'POST',
                        redirect: 'follow',
                        headers: {
                            'Content-Type': 'text/plain',
                        },
                        body: JSON.stringify({
                            entryId: entry.id,
                            user: entry.user,
                            task: entry.task,
                            startTime: new Date(entry.startTime).toLocaleString(),
                            endTime: new Date(entry.endTime).toLocaleString(),
                            duration: (entry.duration / 3600).toFixed(2)
                        })
                    });
                    
                    console.log('Response status:', response.status);
                    
                    setSyncMessage('✓ Synced to Google Sheets!');
                    setTimeout(() => setSyncMessage(''), 5000);
                    return true;
                } catch (error) {
                    console.error('Sync error:', error);
                    setSyncMessage(`✗ Sync failed: ${error.message}`);
                    setTimeout(() => setSyncMessage(''), 5000);
                    return false;
                } finally {
                    setSyncing(false);
                }
            };

            const startTracking = () => {
                if (!currentTask.trim()) {
                    alert('Please enter what you\'re tracking');
                    return;
                }
                setStartTime(Date.now());
                setIsTracking(true);
                setElapsedSeconds(0);
            };

            const stopTracking = async () => {
                if (!isTracking) return;
                
                const endTime = Date.now();
                const duration = Math.floor((endTime - startTime) / 1000);
                
                const newEntry = {
                    id: Date.now(),
                    user: userName,
                    task: currentTask,
                    startTime: startTime,
                    endTime: endTime,
                    duration: duration
                };
                
                setEntries([newEntry, ...entries]);
                setIsTracking(false);
                setCurrentTask('');
                setElapsedSeconds(0);
                setStartTime(null);

                await syncToSheet(newEntry);
            };

            const deleteEntry = (id) => {
                setEntries(entries.filter(e => e.id !== id));
            };

            const startEdit = (entry) => {
                setEditingId(entry.id);
                setEditTask(entry.task);
                setEditStartTime(formatDateTimeForInput(entry.startTime));
                setEditEndTime(formatDateTimeForInput(entry.endTime));
            };

            const saveEdit = async (id) => {
                const newStartTime = new Date(editStartTime).getTime();
                const newEndTime = new Date(editEndTime).getTime();
                const newDuration = Math.floor((newEndTime - newStartTime) / 1000);
                
                if (newEndTime <= newStartTime) {
                    alert('End time must be after start time');
                    return;
                }
                
                const updatedEntry = entries.find(e => e.id === id);
                const newEntry = {
                    ...updatedEntry,
                    task: editTask,
                    startTime: newStartTime,
                    endTime: newEndTime,
                    duration: newDuration
                };
                
                setEntries(entries.map(e => 
                    e.id === id ? newEntry : e
                ));
                setEditingId(null);
                setEditTask('');
                setEditStartTime('');
                setEditEndTime('');
                
                // Sync the updated entry to Google Sheets
                await syncToSheet(newEntry);
            };

            const cancelEdit = () => {
                setEditingId(null);
                setEditTask('');
                setEditStartTime('');
                setEditEndTime('');
            };

            const saveSettings = () => {
                localStorage.setItem('sheetUrl', sheetUrl);
                localStorage.setItem('userName', userName);
                localStorage.setItem('userOptions', JSON.stringify(userOptions));
                localStorage.setItem('taskOptions', JSON.stringify(taskOptions));
                setShowSettings(false);
                setShowNamePrompt(false);
            };

            if (showNamePrompt && !showSettings) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 flex items-center justify-center">
                        <div className="bg-white rounded-2xl shadow-lg p-8 max-w-md w-full">
                            <h2 className="text-2xl font-bold text-gray-800 mb-4">Welcome!</h2>
                            <p className="text-gray-600 mb-6">Select your name to start tracking time:</p>
                            <select
                                value={userName}
                                onChange={(e) => setUserName(e.target.value)}
                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-lg mb-4 focus:outline-none focus:border-indigo-500"
                            >
                                <option value="">Choose your name...</option>
                                {userOptions.map(name => (
                                    <option key={name} value={name}>{name}</option>
                                ))}
                            </select>
                            <button
                                onClick={() => userName.trim() && setShowNamePrompt(false)}
                                disabled={!userName.trim()}
                                className="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold text-lg hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition mb-3"
                            >
                                Start
                            </button>
                            <button
                                onClick={() => setShowSettings(true)}
                                className="w-full bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold text-lg hover:bg-gray-300 transition flex items-center justify-center gap-2"
                            >
                                <Settings size={20} />
                                Configure Google Sheets
                            </button>
                        </div>
                    </div>
                );
            }

            if (showSettings) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 flex items-center justify-center">
                        <div className="bg-white rounded-2xl shadow-lg p-8 max-w-2xl w-full">
                            <h2 className="text-2xl font-bold text-gray-800 mb-4">Settings</h2>
                            
                            <div className="mb-6">
                                <label className="block text-sm font-semibold text-gray-700 mb-2">Your Name</label>
                                <select
                                    value={userName}
                                    onChange={(e) => setUserName(e.target.value)}
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-500"
                                >
                                    <option value="">Select your name...</option>
                                    {userOptions.map(name => (
                                        <option key={name} value={name}>{name}</option>
                                    ))}
                                </select>
                            </div>

                            <div className="mb-6">
                                <label className="block text-sm font-semibold text-gray-700 mb-2">Google Apps Script URL</label>
                                <input
                                    type="text"
                                    value={sheetUrl}
                                    onChange={(e) => setSheetUrl(e.target.value)}
                                    placeholder="https://script.google.com/macros/s/..."
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-500 text-sm"
                                />
                            </div>

                            <div className="mb-6">
                                <label className="block text-sm font-semibold text-gray-700 mb-2">Family Member Names (comma-separated)</label>
                                <input
                                    type="text"
                                    value={userOptions.join(', ')}
                                    onChange={(e) => setUserOptions(e.target.value.split(',').map(s => s.trim()).filter(s => s))}
                                    placeholder="Scott, Sarah, Alex, Emma"
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-500"
                                />
                            </div>

                            <div className="mb-6">
                                <label className="block text-sm font-semibold text-gray-700 mb-2">Task Options (comma-separated)</label>
                                <input
                                    type="text"
                                    value={taskOptions.join(', ')}
                                    onChange={(e) => setTaskOptions(e.target.value.split(',').map(s => s.trim()).filter(s => s))}
                                    placeholder="Homework, Reading, Chores, Practice"
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-500"
                                />
                            </div>

                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6 text-sm">
                                <p className="font-semibold text-blue-900 mb-2">Setup Instructions:</p>
                                <ol className="list-decimal list-inside space-y-1 text-blue-800">
                                    <li>Open your Google Sheet</li>
                                    <li>Go to Extensions → Apps Script</li>
                                    <li>Paste the provided script code</li>
                                    <li>Click Deploy → New deployment</li>
                                    <li>Select "Web app", set access to "Anyone"</li>
                                    <li>Copy the URL and paste it above</li>
                                </ol>
                            </div>

                            <div className="flex gap-3">
                                <button
                                    onClick={saveSettings}
                                    disabled={!userName.trim()}
                                    className="flex-1 bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition"
                                >
                                    Save Settings
                                </button>
                                <button
                                    onClick={() => setShowSettings(false)}
                                    className="px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-300 transition"
                                >
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                    <div className="max-w-2xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-lg p-6 mb-6">
                            <div className="flex justify-between items-center mb-4">
                                <h1 className="text-3xl font-bold text-gray-800">Time Tracker</h1>
                                <div className="flex items-center gap-3">
                                    {syncMessage && (
                                        <div className="text-sm font-semibold text-gray-700">
                                            {syncMessage}
                                        </div>
                                    )}
                                    <button
                                        onClick={() => setShowSettings(true)}
                                        className="p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition"
                                    >
                                        <Settings size={24} />
                                    </button>
                                </div>
                            </div>
                            
                            <div className="text-right mb-4">
                                <div className="text-sm text-gray-500">Logged in as</div>
                                <div className="font-semibold text-indigo-600">{userName}</div>
                                {sheetUrl && (
                                    <div className="text-xs text-green-600 mt-1">✓ Syncing to Google Sheets</div>
                                )}
                            </div>
                            
                            {isTracking && (
                                <div className="text-center mb-4">
                                    <div className="text-5xl font-mono font-bold text-indigo-600 mb-2">
                                        {formatTime(elapsedSeconds)}
                                    </div>
                                    <div className="text-gray-600">Tracking: {currentTask}</div>
                                </div>
                            )}
                            
                            {!isTracking && (
                                <select
                                    value={currentTask}
                                    onChange={(e) => setCurrentTask(e.target.value)}
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-lg mb-4 focus:outline-none focus:border-indigo-500"
                                >
                                    <option value="">What are you working on?</option>
                                    {taskOptions.map(task => (
                                        <option key={task} value={task}>{task}</option>
                                    ))}
                                </select>
                            )}
                            
                            <button
                                onClick={isTracking ? stopTracking : startTracking}
                                disabled={syncing}
                                className={`w-full py-4 rounded-xl font-bold text-xl flex items-center justify-center gap-3 transition ${
                                    isTracking
                                        ? 'bg-red-500 hover:bg-red-600 text-white'
                                        : 'bg-green-500 hover:bg-green-600 text-white'
                                } ${syncing ? 'opacity-50 cursor-not-allowed' : ''}`}
                            >
                                {syncing ? (
                                    <>
                                        <RefreshCw size={28} />
                                        Syncing...
                                    </>
                                ) : isTracking ? (
                                    <>
                                        <Square />
                                        Stop Tracking
                                    </>
                                ) : (
                                    <>
                                        <Play />
                                        Start Tracking
                                    </>
                                )}
                            </button>
                        </div>

                        <div className="space-y-3">
                            {entries.map(entry => (
                                <div key={entry.id} className="bg-white rounded-xl shadow p-4">
                                    {editingId === entry.id ? (
                                        <div className="space-y-3">
                                            <div>
                                                <label className="block text-xs font-semibold text-gray-600 mb-1">Task</label>
                                                <input
                                                    type="text"
                                                    value={editTask}
                                                    onChange={(e) => setEditTask(e.target.value)}
                                                    className="w-full px-3 py-2 border-2 border-indigo-300 rounded-lg focus:outline-none focus:border-indigo-500"
                                                />
                                            </div>
                                            <div className="grid grid-cols-2 gap-3">
                                                <div>
                                                    <label className="block text-xs font-semibold text-gray-600 mb-1">Start Time</label>
                                                    <input
                                                        type="datetime-local"
                                                        value={editStartTime}
                                                        onChange={(e) => setEditStartTime(e.target.value)}
                                                        className="w-full px-3 py-2 border-2 border-indigo-300 rounded-lg focus:outline-none focus:border-indigo-500 text-sm"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-xs font-semibold text-gray-600 mb-1">End Time</label>
                                                    <input
                                                        type="datetime-local"
                                                        value={editEndTime}
                                                        onChange={(e) => setEditEndTime(e.target.value)}
                                                        className="w-full px-3 py-2 border-2 border-indigo-300 rounded-lg focus:outline-none focus:border-indigo-500 text-sm"
                                                    />
                                                </div>
                                            </div>
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={() => saveEdit(entry.id)}
                                                    className="flex-1 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 font-semibold"
                                                >
                                                    Save Changes
                                                </button>
                                                <button
                                                    onClick={cancelEdit}
                                                    className="px-6 py-2 bg-gray-400 text-white rounded-lg hover:bg-gray-500 font-semibold"
                                                >
                                                    Cancel
                                                </button>
                                            </div>
                                        </div>
                                    ) : (
                                        <>
                                            <div className="flex justify-between items-start mb-2">
                                                <div className="flex-1">
                                                    <div className="font-semibold text-lg text-gray-800">{entry.task}</div>
                                                    <div className="text-sm text-gray-500">by {entry.user}</div>
                                                </div>
                                                <div className="text-2xl font-bold text-indigo-600">
                                                    {formatTime(entry.duration)}
                                                </div>
                                            </div>
                                            <div className="flex justify-between items-center text-sm text-gray-600">
                                                <div>
                                                    {formatDateTime(entry.startTime)} → {formatDateTime(entry.endTime)}
                                                </div>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => startEdit(entry)}
                                                        className="p-1 text-blue-600 hover:bg-blue-50 rounded"
                                                    >
                                                        <Edit2 size={16} />
                                                    </button>
                                                    <button
                                                        onClick={() => deleteEntry(entry.id)}
                                                        className="p-1 text-red-600 hover:bg-red-50 rounded"
                                                    >
                                                        <Trash2 size={16} />
                                                    </button>
                                                </div>
                                            </div>
                                        </>
                                    )}
                                </div>
                            ))}
                        </div>

                        {entries.length === 0 && !isTracking && (
                            <div className="text-center text-gray-500 mt-8">
                                No time entries yet. Start tracking to begin!
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TimeTracker />, document.getElementById('root'));
    </script>
</body>
</html>
